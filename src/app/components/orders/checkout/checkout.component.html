<div class="max-w-6xl mx-auto p-6 bg-white shadow-md rounded-lg mt-10">
  <h2 class="text-2xl font-semibold mb-6 text-gray-800">üõç Checkout</h2>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- LEFT: Address, Payment, Notes -->
    <div class="md:col-span-2 space-y-6">
      <!-- Address Section -->
      <div>
        <div
          class="p-4 border rounded-lg cursor-pointer transition-all border-blue-500 bg-blue-50"
        >
          <p class="font-semibold text-gray-800">
            {{ currPrimaryAddress()?.recipientName }}
          </p>
          <p class="text-sm text-gray-600">
            {{ currPrimaryAddress()?.line1 }}, {{ currPrimaryAddress()?.city }},
            {{ currPrimaryAddress()?.state }} -
            {{ currPrimaryAddress()?.postalCode }}
          </p>
          <p class="text-sm text-gray-500">
            üìû {{ currPrimaryAddress()?.phone }}
          </p>
        </div>

        <p
          (click)="changeAddress.set(true)"
          class="items-end text-right text-blue-500 hover:underline hover:cursor-pointer mt-1"
        >
          Change Address
        </p>

        <!-- Address List -->
        <div *ngIf="changeAddress()">
          <h3 class="text-lg font-medium text-gray-700 mb-2">Select Address</h3>
          <div class="space-y-3">
            <div
              *ngFor="let addr of addresses()"
              (click)="selectAddress(addr)"
              class="p-4 border rounded-lg cursor-pointer transition-all"
              [class.border-blue-500]="addr.id === currPrimaryAddress()?.id"
              [class.bg-blue-50]="addr.id === currPrimaryAddress()?.id"
            >
              <p class="font-semibold text-gray-800">
                {{ addr.recipientName }}
              </p>
              <p class="text-sm text-gray-600">
                {{ addr.line1 }}, {{ addr.city }}, {{ addr.state }} -
                {{ addr.postalCode }}
              </p>
              <p class="text-sm text-gray-500">üìû {{ addr.phone }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Section -->
      <div>
        <h3 class="text-lg font-medium text-gray-700 mb-2">Payment Method</h3>
        <div class="flex gap-6">
          <label
            *ngFor="let method of PaymentMethods"
            class="flex items-center gap-2 cursor-pointer"
          >
            <input
              type="radio"
              [value]="method"
              [checked]="paymentMethod() === method"
              (change)="changePaymentMethod(method)"
            />
            <span>{{ method }}</span>
          </label>
        </div>
      </div>

      <div *ngIf="paymentMethod() == 'UPI'" class="mt-4 space-y-2">
        <label for="" class="text-gray-700 font-medium">Enter UPI Id</label>
        <input
          type="text"
          required
          class="w-full border rounded-lg p-2"
          placeholder="e.g., yourname@upi"
          (input)="upiId.set($any($event.target).value)"
        />
      </div>
      <!-- Notes -->
      <div>
        <label class="text-gray-700 font-medium">Additional Notes</label>
        <textarea
          (input)="notes.set($any($event.target).value)"
          (change)="notes()"
          rows="3"
          class="w-full mt-1 border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Eg: Please deliver between 10am-6pm"
        ></textarea>
      </div>

      <!-- Submit -->
      <div class="text-right">
        <button
          class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
          [disabled]="loading()"
          (click)="checkPayment()"
        >
          {{ loading() ? "Placing Order..." : checkoutMessage() }}
        </button>
      </div>

      <!-- Success Message -->
      <div
        *ngIf="successMessage()"
        class="mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-green-700"
      >
        {{ successMessage() }}
      </div>
    </div>

    <!-- RIGHT: Sticky Order Summary -->
    <div class="md:col-span-1">
      <div
        class="sticky top-24 border border-gray-200 rounded-lg p-4 bg-gray-50 shadow-sm"
      >
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Order Summary</h3>

        <div class="flex justify-between text-gray-700 mb-1">
          <span>Total Items</span>
          <span class="font-medium">{{ cartItems().length }}</span>
        </div>

        <div class="flex justify-between text-gray-700 mb-1">
          <span>Subtotal</span>
          <span class="font-medium">‚Çπ{{ subTotal().toFixed(2) }}</span>
        </div>

        <div class="flex justify-between text-gray-700 mb-1">
          <span>Tax ({{ taxPercent }}%)</span>
          <span class="font-medium">‚Çπ{{ taxAmount().toFixed(2) }}</span>
        </div>

        <div class="flex justify-between text-gray-700 mb-1">
          <span>Shipping</span>
          <span class="font-medium">‚Çπ{{ shippingCharge().toFixed(2) }}</span>
        </div>

        <hr class="my-2" />

        <div class="flex justify-between text-lg font-semibold text-green-700">
          <span class="mr-2">Total Amount </span>
          <span> ‚Çπ{{ totalAmount().toFixed(2) }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
