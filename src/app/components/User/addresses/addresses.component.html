<div class="max-w-4xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold text-gray-800">Your Addresses</h2>
    <button
      (click)="addAddress()"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
    >
      + Add New
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()">Loading addresses...</div>

  <!-- Address List -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" *ngIf="!loading()">
    @for(addr of addresses(); track addr.id) {
    <div
      class="bg-white rounded-xl shadow p-5 border hover:shadow-md transition relative"
    >
      <div class="absolute top-2 right-2">
        <span
          *ngIf="addr.isDefault"
          class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full"
        >
          Default
        </span>
      </div>

      <h3 class="text-lg font-semibold text-gray-800 mb-1">
        {{ addr.recipientName }}
      </h3>
      <p class="text-gray-600 text-sm">{{ addr.line1 }}</p>
      <p class="text-gray-600 text-sm">{{ addr.line2 }}</p>
      <p class="text-gray-600 text-sm">
        {{ addr.city }}, {{ addr.state }}, {{ addr.postalCode }}
      </p>
      <p class="text-gray-500 text-sm mt-1">ğŸ“ {{ addr.phone }}</p>

      <div class="flex justify-between items-center mt-4">
        <button
          (click)="editAddress(addr)"
          class="text-blue-600 hover:underline text-sm"
        >
          Edit
        </button>

        <button
          (click)="deleteAddress(addr.id)"
          class="text-red-600 hover:underline text-sm"
        >
          Delete
        </button>
      </div>

      <div class="mt-3">
        <button
          *ngIf="!addr.isDefault"
          (click)="setDefault(addr.id)"
          class="text-xs text-gray-900 underline hover:text-blue-700"
        >
          Set as Default
        </button>
      </div>
    </div>
    }
  </div>

  <!-- Address Form -->
  <div
    *ngIf="showForm()"
    class="fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50"
  >
    <div class="bg-white w-full max-w-lg p-6 rounded-2xl shadow-lg relative">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">
        {{ editingId ? "Edit Address" : "Add New Address" }}
      </h3>

      <form [formGroup]="addressForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <input
          type="text"
          formControlName="label"
          placeholder="Label (e.g. Home, Office)"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
        />

        <input
          type="text"
          formControlName="recipientName"
          placeholder="Recipient Name"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
        />

        <input
          type="text"
          formControlName="line1"
          placeholder="Address Line 1"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
        />

        <input
          type="text"
          formControlName="line2"
          placeholder="Address Line 2"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
        />

        <div class="grid grid-cols-2 gap-3">
          <input
            type="text"
            formControlName="city"
            placeholder="City"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          />
          <input
            type="text"
            formControlName="state"
            placeholder="State"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          />
        </div>

        <div class="grid grid-cols-2 gap-3">
          <input
            type="text"
            formControlName="postalCode"
            placeholder="Postal Code"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          />
          <input
            type="text"
            formControlName="phone"
            placeholder="Phone Number"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          />
        </div>

        <label class="flex items-center space-x-2">
          <input type="checkbox" formControlName="isDefault" />
          <span class="text-sm text-gray-700">Set as default</span>
        </label>

        <div class="flex justify-end gap-3 mt-4">
          <button
            type="button"
            (click)="cancel()"
            class="px-4 py-2 border rounded-lg hover:bg-gray-100"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            {{ editingId ? "Update" : "Save" }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
